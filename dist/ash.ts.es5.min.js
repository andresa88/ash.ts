!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.ash={})}(this,function(t){"use strict";var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,i)};function i(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}function n(t){var e="function"==typeof Symbol&&t[Symbol.iterator],i=0;return e?e.call(t):{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}}}function o(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,r=i.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=r.next()).done;)s.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}return s}var r=function(){return function(){this.previous=null,this.next=null,this.listener=null,this.once=!1}}(),s=function(){function t(){this.tail=null,this.cacheTail=null}return t.prototype.get=function(){if(this.tail){var t=this.tail;return this.tail=this.tail.previous,t.previous=null,t}return new r},t.prototype.dispose=function(t){t.listener=null,t.once=!1,t.next=null,t.previous=this.tail,this.tail=t},t.prototype.cache=function(t){t.listener=null,t.previous=this.cacheTail,this.cacheTail=t},t.prototype.releaseCache=function(){for(;this.cacheTail;){var t=this.cacheTail;this.cacheTail=t.previous,t.next=null,t.previous=this.tail,this.tail=t}},t}(),a=function(){function t(){this.head=null,this.tail=null,this.toAddHead=null,this.toAddTail=null,this.dispatching=!1,this.pNumListeners=0,this.nodes=new Map,this.listenerNodePool=new s}return t.prototype.startDispatch=function(){this.dispatching=!0},t.prototype.endDispatch=function(){this.dispatching=!1,this.toAddHead&&(this.head?(this.tail.next=this.toAddHead,this.toAddHead.previous=this.tail,this.tail=this.toAddTail):(this.head=this.toAddHead,this.tail=this.toAddTail),this.toAddHead=null,this.toAddTail=null),this.listenerNodePool.releaseCache()},Object.defineProperty(t.prototype,"numListeners",{get:function(){return this.pNumListeners},enumerable:!0,configurable:!0}),t.prototype.add=function(t){if(!this.nodes.has(t)){var e=this.listenerNodePool.get();e.listener=t,this.nodes.set(t,e),this.addNode(e)}},t.prototype.addOnce=function(t){if(!this.nodes.has(t)){var e=this.listenerNodePool.get();e.listener=t,e.once=!0,this.nodes.set(t,e),this.addNode(e)}},t.prototype.addNode=function(t){this.dispatching?this.toAddHead?(this.toAddTail.next=t,t.previous=this.toAddTail,this.toAddTail=t):this.toAddHead=this.toAddTail=t:this.head?(this.tail.next=t,t.previous=this.tail,this.tail=t):this.head=this.tail=t,this.pNumListeners+=1},t.prototype.remove=function(t){var e=this.nodes.get(t)||null;e&&(this.head===e&&(this.head=this.head.next),this.tail===e&&(this.tail=this.tail.previous),this.toAddHead===e&&(this.toAddHead=this.toAddHead.next),this.toAddTail===e&&(this.toAddTail=this.toAddTail.previous),e.previous&&(e.previous.next=e.next),e.next&&(e.next.previous=e.previous),this.nodes.delete(t),this.dispatching?this.listenerNodePool.cache(e):this.listenerNodePool.dispose(e),this.pNumListeners-=1)},t.prototype.removeAll=function(){for(;this.head;){var t=this.head;this.head=this.head.next,this.nodes.delete(t.listener),this.listenerNodePool.dispose(t)}this.tail=null,this.toAddHead=null,this.toAddTail=null,this.pNumListeners=0},t}(),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.dispatch=function(){var t;for(this.startDispatch(),t=this.head;t;t=t.next)t.listener.call(t),t.once&&this.remove(t.listener);this.endDispatch()},e}(a),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.dispatch=function(t){var e;for(this.startDispatch(),e=this.head;e;e=e.next)e.listener.call(e,t),e.once&&this.remove(e.listener);this.endDispatch()},e}(a),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.dispatch=function(t,e){var i;for(this.startDispatch(),i=this.head;i;i=i.next)i.listener.call(i,t,e),i.once&&this.remove(i.listener);this.endDispatch()},e}(a),d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.dispatch=function(t,e,i){var n;for(this.startDispatch(),n=this.head;n;n=n.next)n.listener.call(n,t,e,i),n.once&&this.remove(n.listener);this.endDispatch()},e}(a),p=function(){function t(){this.head=null,this.tail=null,this.nodeAdded=new u,this.nodeRemoved=new u}return t.prototype.add=function(t){this.head?(this.tail.next=t,t.previous=this.tail,t.next=null,this.tail=t):(this.head=this.tail=t,t.next=t.previous=null),this.nodeAdded.dispatch(t)},t.prototype.remove=function(t){this.head===t&&(this.head=this.head.next),this.tail===t&&(this.tail=this.tail.previous),t.previous&&(t.previous.next=t.next),t.next&&(t.next.previous=t.previous),this.nodeRemoved.dispatch(t)},t.prototype.removeAll=function(){for(;this.head;){var t=this.head;this.head=t.next,t.previous=null,t.next=null,this.nodeRemoved.dispatch(t)}this.tail=null},Object.defineProperty(t.prototype,"empty",{get:function(){return null==this.head},enumerable:!0,configurable:!0}),t.prototype.swap=function(t,e){if(t.previous===e)t.previous=e.previous,e.previous=t,e.next=t.next,t.next=e;else if(e.previous===t)e.previous=t.previous,t.previous=e,t.next=e.next,e.next=t;else{var i=t.previous;t.previous=e.previous,e.previous=i,i=t.next,t.next=e.next,e.next=i}this.head===t?this.head=e:this.head===e&&(this.head=t),this.tail===t?this.tail=e:this.tail===e&&(this.tail=t),t.previous&&(t.previous.next=t),e.previous&&(e.previous.next=e),t.next&&(t.next.previous=t),e.next&&(e.next.previous=e)},t.prototype.insertionSort=function(t){if(this.head!==this.tail)for(var e=this.head.next,i=e;i;i=e){var n=void 0;for(e=i.next,n=i.previous;n;n=n.previous)if(t(i,n)>=0){i!==n.next&&(this.tail===i&&(this.tail=i.previous),i.previous.next=i.next,i.next&&(i.next.previous=i.previous),i.next=n.next,i.previous=n,i.next.previous=i,n.next=i);break}n||(this.tail===i&&(this.tail=i.previous),i.previous.next=i.next,i.next&&(i.next.previous=i.previous),i.next=this.head,this.head.previous=i,i.previous=null,this.head=i)}},t.prototype.mergeSort=function(t){if(this.head!==this.tail){for(var e,i=[],n=this.head;n;){for(e=n;e.next&&t(e,e.next)<=0;)e=e.next;var o=e.next;n.previous=e.next=null,i[i.length]=n,n=o}for(;i.length>1;)i.push(this.merge(i.shift(),i.shift(),t));for(this.tail=this.head=i[0];this.tail.next;)this.tail=this.tail.next}},t.prototype.merge=function(t,e,i){var n,o;for(i(t,e)<=0?(o=n=t,t=t.next):(o=n=e,e=e.next);t&&e;)i(t,e)<=0?(n.next=t,t.previous=n,n=t,t=t.next):(n.next=e,e.previous=n,n=e,e=e.next);return t?(n.next=t,t.previous=n):(n.next=e,e.previous=n),o},t}(),c=function(){function t(t,e){this.tail=null,this.cacheTail=null,this.nodeClass=t,this.components=e}return t.prototype.get=function(){if(this.tail){var t=this.tail;return this.tail=this.tail.previous,t.previous=null,t}return new this.nodeClass},t.prototype.dispose=function(t){var e,i;try{for(var o=n(this.components.values()),r=o.next();!r.done;r=o.next()){t[r.value]=null}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(e)throw e.error}}t.entity=null,t.next=null,t.previous=this.tail,this.tail=t},t.prototype.cache=function(t){t.previous=this.cacheTail,this.cacheTail=t},t.prototype.releaseCache=function(){for(;this.cacheTail;){var t=this.cacheTail;this.cacheTail=t.previous,this.dispose(t)}},t}(),f="__ash_types__",y=function(){function t(t,e){var i=this;this.releaseNodePoolCache=function(){i.engine.updateComplete.remove(i.releaseNodePoolCache),i.nodePool.releaseCache()},this.nodeClass=t,this.engine=e,this.init()}return t.prototype.init=function(){var t,e;this.nodes=new p,this.entities=new Map,this.components=new Map,this.nodePool=new c(this.nodeClass,this.components);var i=this.nodePool.get();this.nodePool.dispose(i);var r=i.constructor[f];try{for(var s=n(r),a=s.next();!a.done;a=s.next()){var h=o(a.value,2),u=h[0],l=h[1];this.components.set(l,u)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}},Object.defineProperty(t.prototype,"nodeList",{get:function(){return this.nodes},enumerable:!0,configurable:!0}),t.prototype.newEntity=function(t){this.addIfMatch(t)},t.prototype.componentAddedToEntity=function(t,e){this.addIfMatch(t)},t.prototype.componentRemovedFromEntity=function(t,e){this.components.has(e)&&this.removeIfMatch(t)},t.prototype.removeEntity=function(t){this.removeIfMatch(t)},t.prototype.addIfMatch=function(t){var e,i,o,r;if(!this.entities.has(t)){try{for(var s=n(this.components.keys()),a=s.next();!a.done;a=s.next()){var h=a.value;if(!t.has(h))return}}catch(t){e={error:t}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}var u=this.nodePool.get();u.entity=t;try{for(var l=n(this.components.keys()),d=l.next();!d.done;d=l.next()){h=d.value;u[this.components.get(h)]=t.get(h)}}catch(t){o={error:t}}finally{try{d&&!d.done&&(r=l.return)&&r.call(l)}finally{if(o)throw o.error}}this.entities.set(t,u),this.nodes.add(u)}},t.prototype.removeIfMatch=function(t){if(this.entities.has(t)){var e=this.entities.get(t);this.entities.delete(t),this.nodes.remove(e),this.engine.updating?(this.nodePool.cache(e),this.engine.updateComplete.add(this.releaseNodePoolCache)):this.nodePool.dispose(e)}},t.prototype.cleanUp=function(){for(var t=this.nodes.head;t;t=t.next)this.entities.delete(t.entity);this.nodes.removeAll()},t}();var v=function(){function t(){this.head=null,this.tail=null}return t.prototype.add=function(t){this.head?(this.tail.next=t,t.previous=this.tail,t.next=null,this.tail=t):(this.head=this.tail=t,t.next=t.previous=null)},t.prototype.remove=function(t){this.head===t&&(this.head=this.head.next),this.tail===t&&(this.tail=this.tail.previous),t.previous&&(t.previous.next=t.next),t.next&&(t.next.previous=t.previous)},t.prototype.removeAll=function(){for(;this.head;){var t=this.head;this.head=this.head.next,t.previous=null,t.next=null}this.tail=null},t}(),m=function(){function t(){this.head=null,this.tail=null}return t.prototype.add=function(t){if(this.head){var e=void 0;for(e=this.tail;e&&!(e.priority<=t.priority);e=e.previous);e===this.tail?(this.tail.next=t,t.previous=this.tail,t.next=null,this.tail=t):e?(t.next=e.next,t.previous=e,e.next.previous=t,e.next=t):(t.next=this.head,t.previous=null,this.head.previous=t,this.head=t)}else this.head=this.tail=t,t.next=t.previous=null},t.prototype.remove=function(t){this.head===t&&(this.head=this.head.next),this.tail===t&&(this.tail=this.tail.previous),t.previous&&(t.previous.next=t.next),t.next&&(t.next.previous=t.previous)},t.prototype.removeAll=function(){for(;this.head;){var t=this.head;this.head=this.head.next,t.previous=null,t.next=null}this.tail=null},t.prototype.get=function(t){for(var e=this.head;e;e=e.next)if(e instanceof t)return e;return null},t}(),g=function(){function t(){var t=this;this.updating=!1,this.familyClass=y,this.entityNameChanged=function(e,i){t.entityNames.get(i)===e&&(t.entityNames.delete(i),t.entityNames.set(e.name,e))},this.componentAdded=function(e,i){var o,r;try{for(var s=n(t.families.values()),a=s.next();!a.done;a=s.next()){a.value.componentAddedToEntity(e,i)}}catch(t){o={error:t}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}},this.componentRemoved=function(e,i){var o,r;try{for(var s=n(t.families.values()),a=s.next();!a.done;a=s.next()){a.value.componentRemovedFromEntity(e,i)}}catch(t){o={error:t}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}},this.entityList=new v,this.entityNames=new Map,this.systemList=new m,this.families=new Map,this.updateComplete=new h}return t.prototype.addEntity=function(t){var e,i;if(this.entityNames.has(t.name))throw new Error("The entity name "+t.name+" is already in use by another entity.");this.entityList.add(t),this.entityNames.set(t.name,t),t.componentAdded.add(this.componentAdded),t.componentRemoved.add(this.componentRemoved),t.nameChanged.add(this.entityNameChanged);try{for(var o=n(this.families.values()),r=o.next();!r.done;r=o.next()){r.value.newEntity(t)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(e)throw e.error}}},t.prototype.removeEntity=function(t){var e,i;t.componentAdded.remove(this.componentAdded),t.componentRemoved.remove(this.componentRemoved),t.nameChanged.remove(this.entityNameChanged);try{for(var o=n(this.families.values()),r=o.next();!r.done;r=o.next()){r.value.removeEntity(t)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(e)throw e.error}}this.entityNames.delete(t.name),this.entityList.remove(t)},t.prototype.getEntityByName=function(t){return this.entityNames.get(t)||null},t.prototype.removeAllEntities=function(){for(;this.entityList.head;)this.removeEntity(this.entityList.head)},Object.defineProperty(t.prototype,"entities",{get:function(){for(var t=[],e=this.entityList.head;e;e=e.next)t[t.length]=e;return t},enumerable:!0,configurable:!0}),t.prototype.getNodeList=function(t){if(this.families.has(t))return this.families.get(t).nodeList;var e=new this.familyClass(t,this);this.families.set(t,e);for(var i=this.entityList.head;i;i=i.next)e.newEntity(i);return e.nodeList},t.prototype.releaseNodeList=function(t){this.families.has(t)&&this.families.get(t).cleanUp(),this.families.delete(t)},t.prototype.addSystem=function(t,e){t.priority=e,t.addToEngine(this),this.systemList.add(t)},t.prototype.getSystem=function(t){return this.systemList.get(t)},Object.defineProperty(t.prototype,"systems",{get:function(){for(var t=[],e=this.systemList.head;e;e=e.next)t[t.length]=e;return t},enumerable:!0,configurable:!0}),t.prototype.removeSystem=function(t){this.systemList.remove(t),t.removeFromEngine(this)},t.prototype.removeAllSystems=function(){for(;this.systemList.head;){var t=this.systemList.head;this.systemList.head=this.systemList.head.next,t.previous=null,t.next=null,t.removeFromEngine(this)}this.systemList.tail=null},t.prototype.update=function(t){this.updating=!0;for(var e=this.systemList.head;e;e=e.next)e.update(t);this.updating=!1,this.updateComplete.dispatch()},t}(),x=function(){function t(e){void 0===e&&(e=""),this.previous=null,this.next=null,this.componentAdded=new l,this.componentRemoved=new l,this.nameChanged=new l,this.components=new Map,e?this.pName=e:(t.nameCount+=1,this.pName="_entity"+t.nameCount)}return Object.defineProperty(t.prototype,"name",{get:function(){return this.pName},set:function(t){if(this.pName!==t){var e=this.pName;this.pName=t,this.nameChanged.dispatch(this,e)}},enumerable:!0,configurable:!0}),t.prototype.add=function(t,e){return void 0===e&&(e=null),e||(e=t.constructor.prototype.constructor),e=e,this.components.has(e)&&this.remove(e),this.components.set(e,t),this.componentAdded.dispatch(this,e),this},t.prototype.remove=function(t){var e=this.components.get(t);return e?(this.components.delete(t),this.componentRemoved.dispatch(this,t),e):null},t.prototype.get=function(t){return this.components.get(t)},t.prototype.getAll=function(){var t,e,i=[];try{for(var o=n(this.components.values()),r=o.next();!r.done;r=o.next()){var s=r.value;i[i.length]=s}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}return i},t.prototype.has=function(t){return this.components.has(t)},t.nameCount=0,t}(),w=function(){return function(){this.entity=null,this.previous=null,this.next=null}}(),b=function(){return function(){this.previous=null,this.next=null,this.priority=0}}(),P=function(){function t(t){this.instance=t}return t.prototype.getComponent=function(){return this.instance},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.instance},enumerable:!0,configurable:!0}),t}(),A=function(){function t(t){this.componentType=t}return t.prototype.getComponent=function(){return this.instance||(this.instance=new this.componentType),this.instance},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.getComponent()},enumerable:!0,configurable:!0}),t}(),S=function(){function t(t){this.componentType=t}return t.prototype.getComponent=function(){return new this.componentType},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.componentType},enumerable:!0,configurable:!0}),t}(),T=function(){function t(t){this.closure=t}return t.prototype.getComponent=function(){return this.closure()},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.closure},enumerable:!0,configurable:!0}),t}(),N=function(){function t(t,e){this.creatingState=t,this.componentType=e,this.withType(e)}return t.prototype.withInstance=function(t){return this.setProvider(new P(t)),this},t.prototype.withType=function(t){return this.setProvider(new S(t)),this},t.prototype.withSingleton=function(t){return t||(t=this.componentType),this.setProvider(new A(t)),this},t.prototype.withMethod=function(t){return this.setProvider(new T(t)),this},t.prototype.withProvider=function(t){return this.setProvider(t),this},t.prototype.add=function(t){return this.creatingState.add(t)},t.prototype.setProvider=function(t){this.provider=t,this.creatingState.providers.set(this.componentType,t)},t}(),L=function(){function t(){this.providers=new Map}return t.prototype.add=function(t){return new N(this,t)},t.prototype.get=function(t){return this.providers.get(t)||null},t.prototype.has=function(t){return this.providers.has(t)},t}(),C=function(){function t(t){this.entity=t,this.states={}}return t.prototype.addState=function(t,e){return this.states[t]=e,this},t.prototype.createState=function(t){var e=new L;return this.states[t]=e,e},t.prototype.changeState=function(t){var e,i,o,r,s,a,h=this.states[t];if(!h)throw new Error("Entity state "+t+" doesn't exist");if(h!==this.currentState){var u;if(this.currentState){u=new Map;try{for(var l=n(h.providers.keys()),d=l.next();!d.done;d=l.next()){var p=d.value;u.set(p,h.providers.get(p))}}catch(t){e={error:t}}finally{try{d&&!d.done&&(i=l.return)&&i.call(l)}finally{if(e)throw e.error}}try{for(var c=n(this.currentState.providers.keys()),f=c.next();!f.done;f=c.next()){p=f.value;var y=u.get(p)||null;y&&y.identifier===this.currentState.providers.get(p).identifier?u.delete(p):this.entity.remove(p)}}catch(t){o={error:t}}finally{try{f&&!f.done&&(r=c.return)&&r.call(c)}finally{if(o)throw o.error}}}else u=h.providers;try{for(var v=n(u.keys()),m=v.next();!m.done;m=v.next()){p=m.value;this.entity.add(u.get(p).getComponent(),p)}}catch(t){s={error:t}}finally{try{m&&!m.done&&(a=v.return)&&a.call(v)}finally{if(s)throw s.error}}this.currentState=h}else h=null},t}(),I=function(){function t(t){this.systemPriority=0,this.method=t}return t.prototype.getSystem=function(){return this.method()},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.method},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"priority",{get:function(){return this.systemPriority},set:function(t){this.systemPriority=t},enumerable:!0,configurable:!0}),t}(),E=function(){function t(t,e){this.creatingState=t,this.provider=e}return t.prototype.withPriority=function(t){return this.provider.priority=t,this},t.prototype.addInstance=function(t){return this.creatingState.addInstance(t)},t.prototype.addSingleton=function(t){return this.creatingState.addSingleton(t)},t.prototype.addMethod=function(t){return this.creatingState.addMethod(t)},t.prototype.addProvider=function(t){return this.creatingState.addProvider(t)},t}(),O=function(){function t(t){this.systemPriority=0,this.instance=t}return t.prototype.getSystem=function(){return this.instance},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"priority",{get:function(){return this.systemPriority},set:function(t){this.systemPriority=t},enumerable:!0,configurable:!0}),t}(),j=function(){function t(t){this.systemPriority=0,this.componentType=t}return t.prototype.getSystem=function(){return this.instance||(this.instance=new this.componentType),this.instance},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.getSystem()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"priority",{get:function(){return this.systemPriority},set:function(t){this.systemPriority=t},enumerable:!0,configurable:!0}),t}(),M=function(){function t(){this.providers=[]}return t.prototype.addInstance=function(t){return this.addProvider(new O(t))},t.prototype.addSingleton=function(t){return this.addProvider(new j(t))},t.prototype.addMethod=function(t){return this.addProvider(new I(t))},t.prototype.addProvider=function(t){var e=new E(this,t);return this.providers[this.providers.length]=t,e},t}(),R=function(){function t(t){this.engine=t,this.states={}}return t.prototype.addState=function(t,e){return this.states[t]=e,this},t.prototype.createState=function(t){var e=new M;return this.states[t]=e,e},t.prototype.changeState=function(t){var e,i,o,r,s,a,h=this.states[t];if(!h)throw new Error("Engine state "+t+" doesn't exist");if(h!==this.currentState){var u,l=[];try{for(var d=n(h.providers),p=d.next();!p.done;p=d.next()){l[u=(m=p.value).identifier]=m}}catch(t){e={error:t}}finally{try{p&&!p.done&&(i=d.return)&&i.call(d)}finally{if(e)throw e.error}}if(this.currentState)try{for(var c=n(this.currentState.providers),f=c.next();!f.done;f=c.next()){l[u=(m=f.value).identifier]?delete l[u]:this.engine.removeSystem(m.getSystem())}}catch(t){o={error:t}}finally{try{f&&!f.done&&(r=c.return)&&r.call(c)}finally{if(o)throw o.error}}try{for(var y=n(l),v=y.next();!v.done;v=y.next()){var m=v.value;this.engine.addSystem(m.getSystem(),m.priority)}}catch(t){s={error:t}}finally{try{v&&!v.done&&(a=y.return)&&a.call(y)}finally{if(s)throw s.error}}this.currentState=h}else h=null},t}(),_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.rafId=0,e.previousTime=0,e.update=function(){e.rafId=window.requestAnimationFrame(e.update);var t=Date.now();e.dispatch((t-e.previousTime)/1e3),e.previousTime=t},e}return i(e,t),e.prototype.start=function(){this.previousTime=Date.now(),this.rafId=window.requestAnimationFrame(this.update)},e.prototype.stop=function(){window.cancelAnimationFrame(this.rafId),this.rafId=0},Object.defineProperty(e.prototype,"playing",{get:function(){return!!this.rafId},enumerable:!0,configurable:!0}),e}(u),D=function(t){function e(e){var i=t.call(this)||this;return i.intervalId=0,i.previousTime=0,i.pInterval=33,i.update=function(){var t=Date.now();i.dispatch((t-i.previousTime)/1e3),i.previousTime=t},e&&(i.pInterval=e),i}return i(e,t),e.prototype.start=function(){this.previousTime=Date.now(),this.intervalId=window.setInterval(this.update,this.pInterval)},e.prototype.stop=function(){window.clearInterval(this.intervalId),this.intervalId=0},Object.defineProperty(e.prototype,"interval",{set:function(t){this.pInterval=t,0!==this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=window.setInterval(this.update,t))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inteval",{get:function(){return this.pInterval},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){return!!this.intervalId},enumerable:!0,configurable:!0}),e}(u),H=function(){function t(){}return t.getPool=function(e){if(t.pools.has(e))return t.pools.get(e);var i=[];return t.pools.set(e,i),i},t.get=function(e){var i=t.getPool(e);return i.length>0?i.pop():new e},t.dispose=function(e){if(e){var i=e.constructor.prototype.constructor,n=t.getPool(i);n[n.length]=e}},t.empty=function(){t.pools=new Map},t.pools=new Map,t}(),F=function(t){function e(e){var i=t.call(this)||this;return i.nodeList=null,i.nodeClass=e,i}return i(e,t),e.prototype.addToEngine=function(t){if(this.nodeList=t.getNodeList(this.nodeClass),this.nodeAdded){for(var e=this.nodeList.head;e;e=e.next)this.nodeAdded(e);this.nodeList.nodeAdded.add(this.nodeAdded)}this.nodeRemoved&&this.nodeList.nodeRemoved.add(this.nodeRemoved)},e.prototype.removeFromEngine=function(t){this.nodeAdded&&this.nodeList.nodeAdded.remove(this.nodeAdded),this.nodeRemoved&&this.nodeList.nodeRemoved.remove(this.nodeRemoved),this.nodeList=null},e.prototype.update=function(t){for(var e=this.nodeList.head;e;e=e.next)this.updateNode(e,t)},e}(b);t.Signal0=h,t.Signal1=u,t.Signal2=l,t.Signal3=d,t.ComponentMatchingFamily=y,t.keep=function(t){return function(e,i){var n,o=e.constructor;o.hasOwnProperty(f)?n=o[f]:(n=new Map,Object.defineProperty(o,f,{enumerable:!0,get:function(){return n}})),n.set(i,t)}},t.Engine=g,t.Entity=x,t.Node=w,t.NodeList=p,t.NodePool=c,t.System=b,t.EntityStateMachine=C,t.EngineStateMachine=R,t.RAFTickProvider=_,t.IntervalTickProvider=D,t.ComponentPool=H,t.ListIteratingSystem=F,Object.defineProperty(t,"__esModule",{value:!0})});
